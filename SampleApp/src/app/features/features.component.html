<div class="features-demo">
  <!-- Event Monitor -->
  <mat-toolbar color="primary" class="event-monitor">
    <div class="quick-stats">
      <mat-chip-listbox class="stats-chips" aria-label="Event Stats">
        <mat-chip-option [selected]="eventCounts.documentLoad>0" matTooltip="Total document loads">üìÑ {{eventCounts.documentLoad}}</mat-chip-option>
        <mat-chip-option [selected]="eventCounts.pageRendered>0" matTooltip="Total page renders">üé® {{eventCounts.pageRendered}}</mat-chip-option>
        <mat-chip-option [selected]="eventCounts.find>0 || eventCounts.updateFindMatchesCount>0" matTooltip="Find ops / matches">üîç {{eventCounts.find}} / {{eventCounts.updateFindMatchesCount}}</mat-chip-option>
        <mat-chip-option [selected]="eventCounts.outlineLoaded>0" matTooltip="Outline loads">üìñ {{eventCounts.outlineLoaded}}</mat-chip-option>
        <mat-chip-option [selected]="eventCounts.documentError>0" matTooltip="Errors">‚ùå {{eventCounts.documentError}}</mat-chip-option>
      </mat-chip-listbox>
    </div>
    <span class="spacer"></span>
    <div class="status-info">Page {{currentPage}}/{{totalPages}} | {{currentScale}} | {{currentRotation}}¬∞</div>
    <button mat-icon-button (click)="resetEventCounts()" matTooltip="Reset counters"><mat-icon>refresh</mat-icon></button>
  </mat-toolbar>

  <div class="demo-content">
    <!-- Configuration Panel -->
    <div class="config-panel">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Library Configuration Demo</mat-card-title>
          <mat-card-subtitle>
            Configure the PDF viewer using different approaches
          </mat-card-subtitle>
        </mat-card-header>
      
        <mat-card-content>
          <mat-tab-group>
            <!-- Traditional Individual Properties -->
            <mat-tab label="Individual Properties">
            <div class="tab-content">
                <h3>Control Visibility</h3>
                <div class="toggle-grid">
                  <mat-slide-toggle [(ngModel)]="showOpenFile">Open File</mat-slide-toggle>
                  <mat-slide-toggle [(ngModel)]="showDownload">Download</mat-slide-toggle>
                  <mat-slide-toggle [(ngModel)]="showPrint">Print</mat-slide-toggle>
                  <mat-slide-toggle [(ngModel)]="showFullScreen">Full Screen</mat-slide-toggle>
                  <mat-slide-toggle [(ngModel)]="showFind">Find</mat-slide-toggle>
                  <mat-slide-toggle [(ngModel)]="showViewBookmark">Bookmarks</mat-slide-toggle>
                  <mat-slide-toggle [(ngModel)]="showAnnotations">Annotations</mat-slide-toggle>
      </div>
      
                <h3>Group Visibility (Phase C)</h3>
                <div class="toggle-grid">
                  <mat-slide-toggle [(ngModel)]="showToolbarLeft">Toolbar Left</mat-slide-toggle>
                  <mat-slide-toggle [(ngModel)]="showToolbarMiddle">Toolbar Middle</mat-slide-toggle>
                  <mat-slide-toggle [(ngModel)]="showToolbarRight">Toolbar Right</mat-slide-toggle>
                  <mat-slide-toggle [(ngModel)]="showSecondaryToolbarToggle">Tools Menu Toggle</mat-slide-toggle>
                  <mat-slide-toggle [(ngModel)]="showSidebar">Sidebar</mat-slide-toggle>
                  <mat-slide-toggle [(ngModel)]="showSidebarLeft">Sidebar Left</mat-slide-toggle>
                  <mat-slide-toggle [(ngModel)]="showSidebarRight">Sidebar Right</mat-slide-toggle>
              </div>

              <mat-divider></mat-divider>

                <!-- Auto-actions execute on component creation, not property changes. -->
                <h3>Auto Actions (execute on load)</h3>
                <p class="mat-caption">Toggle switches and click "Reload Viewer" to test.</p>
                <div class="toggle-grid">
                  <mat-slide-toggle [(ngModel)]="downloadOnLoad">Download on Load</mat-slide-toggle>
                  <mat-slide-toggle [(ngModel)]="printOnLoad">Print on Load</mat-slide-toggle>
                  <mat-slide-toggle [(ngModel)]="showLastPageOnLoad">Show Last Page</mat-slide-toggle>
                </div>
                
                <div class="action-button-container">
                  <button mat-raised-button color="primary" (click)="testAutoActions()" matTooltip="Recreates the entire PDF viewer component to test auto-actions">
                    <mat-icon>refresh</mat-icon> Reload Viewer
                  </button>
              </div>

              <mat-divider></mat-divider>

              <!-- Theme & Visual Customization (Phase 1) -->
              <h3>Theme & Visual Customization</h3>
              
              <!-- Theme Selection -->
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Theme</mat-label>
                <mat-select [(ngModel)]="theme">
                  <mat-option value="light">Light</mat-option>
                  <mat-option value="dark">Dark</mat-option>
                  <mat-option value="auto">Auto (System)</mat-option>
                  </mat-select>
              </mat-form-field>

              <!-- Color Customization -->
              <div class="color-grid">
                <mat-form-field appearance="outline">
                  <mat-label>Primary Color</mat-label>
                  <input matInput type="color" [(ngModel)]="primaryColor" placeholder="#007acc">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Background Color</mat-label>
                  <input matInput type="color" [(ngModel)]="backgroundColor" placeholder="Auto">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Page Background</mat-label>
                  <input matInput type="color" [(ngModel)]="pageBackgroundColor" placeholder="White">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Toolbar Color</mat-label>
                  <input matInput type="color" [(ngModel)]="toolbarColor" placeholder="Auto">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Text Color</mat-label>
                  <input matInput type="color" [(ngModel)]="textColor" placeholder="Auto">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Border Radius</mat-label>
                  <input matInput [(ngModel)]="borderRadius" placeholder="4px">
                </mat-form-field>
              </div>

              <!-- Custom CSS -->
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Custom CSS</mat-label>
                <textarea matInput rows="4" [(ngModel)]="customCSS" 
                          placeholder="Add custom CSS styles here..."></textarea>
                </mat-form-field>

              <mat-divider></mat-divider>

              <!-- Loading & Spinner (Phase 2) -->
              <h3>Loading & Spinner Customization</h3>
              <!-- Layout & Responsive (Phase D) -->
              <h3>Layout & Responsive</h3>
              <div class="binding-grid">
                <mat-form-field>
                  <mat-label>Toolbar Density</mat-label>
                  <mat-select [(ngModel)]="toolbarDensity">
                    <mat-option value="default">Default</mat-option>
                    <mat-option value="compact">Compact</mat-option>
                    <mat-option value="comfortable">Comfortable</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field>
                  <mat-label>Sidebar Width</mat-label>
                  <input matInput placeholder="e.g., 280px" [(ngModel)]="sidebarWidth">
                </mat-form-field>
                <mat-form-field>
                  <mat-label>Toolbar Position</mat-label>
                  <mat-select [(ngModel)]="toolbarPosition">
                    <mat-option value="top">Top</mat-option>
                    <mat-option value="bottom">Bottom</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field>
                  <mat-label>Sidebar Position</mat-label>
                  <mat-select [(ngModel)]="sidebarPosition">
                    <mat-option value="left">Left</mat-option>
                    <mat-option value="right">Right</mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-form-field>
                  <mat-label>Responsive Breakpoint</mat-label>
                  <input matInput placeholder="e.g., 840px or 900" [(ngModel)]="responsiveBreakpoint">
                </mat-form-field>
              </div>
              <div class="toggle-grid">
                <mat-slide-toggle [(ngModel)]="showSpinner">Show Spinner</mat-slide-toggle>
                <mat-slide-toggle [(ngModel)]="useCustomSpinnerTpl">Use Custom Template</mat-slide-toggle>
                <mat-slide-toggle [(ngModel)]="useCustomSpinnerHtml">Use Custom HTML</mat-slide-toggle>
              </div>

              <mat-form-field class="full-width" appearance="outline">
                <mat-label>Spinner CSS Class</mat-label>
                <input matInput [(ngModel)]="spinnerCssClass" placeholder="demo-spinner-overlay">
                </mat-form-field>

              <mat-form-field class="full-width" appearance="outline" *ngIf="useCustomSpinnerHtml">
                <mat-label>Custom Spinner HTML</mat-label>
                <textarea matInput rows="4" [(ngModel)]="customSpinnerHtml"></textarea>
                </mat-form-field>

                <h3>Basic Configuration</h3>
                <div class="config-grid">
                  <mat-form-field>
                    <mat-label>Download File Name</mat-label>
                    <input matInput [(ngModel)]="downloadFileName">
                </mat-form-field>
                  <mat-form-field>
                  <mat-label>Locale</mat-label>
                    <mat-select [(ngModel)]="locale">
                      <mat-option value="en-US">English</mat-option>
                      <mat-option value="de-AT">German</mat-option>
                      <mat-option value="fr-FR">French</mat-option>
                      <mat-option value="es-ES">Spanish</mat-option>
                  </mat-select>
                </mat-form-field>
                  <div class="toggle-container">
                    <mat-slide-toggle [(ngModel)]="useOnlyCssZoom">CSS Zoom Only</mat-slide-toggle>
                  </div>
                  <div class="toggle-container">
                    <mat-slide-toggle [(ngModel)]="showSpinner">Show Loading Spinner</mat-slide-toggle>
                  </div>
                <div class="toggle-container">
                    <mat-slide-toggle [(ngModel)]="diagnosticLogs">Diagnostic Logs</mat-slide-toggle>
                </div>
              </div>
            </div>
          </mat-tab>

            <!-- Convenience Setters Demo -->
            <mat-tab label="Convenience Setters">
              <div class="tab-content">
                <div class="convenience-demo">
                  <h3>Using Convenience Configuration Objects</h3>
                  <p class="demo-info">
                    The library supports convenience setters for cleaner configuration:
                  </p>
                  
                  <mat-expansion-panel>
                    <mat-expansion-panel-header>
                      <mat-panel-title>controlVisibility Config</mat-panel-title>
                    </mat-expansion-panel-header>
                    <pre class="code-example">{{controlVisibilityConfig | json}}</pre>
                    <p>Usage: <code>[controlVisibility]="controlVisibilityConfig"</code></p>
                  </mat-expansion-panel>

                  <mat-expansion-panel>
                    <mat-expansion-panel-header>
                      <mat-panel-title>autoActions Config</mat-panel-title>
                    </mat-expansion-panel-header>
                    <pre class="code-example">{{autoActionsConfig | json}}</pre>
                    <p>Usage: <code>[autoActions]="autoActionsConfig"</code></p>
                  </mat-expansion-panel>

                  <mat-expansion-panel>
                    <mat-expansion-panel-header>
                      <mat-panel-title>viewerConfig</mat-panel-title>
                    </mat-expansion-panel-header>
                    <pre class="code-example">{{viewerConfig | json}}</pre>
                    <p>Usage: <code>[viewerConfig]="viewerConfig"</code></p>
                  </mat-expansion-panel>

                  <mat-expansion-panel>
                    <mat-expansion-panel-header>
                      <mat-panel-title>errorHandling Config</mat-panel-title>
                    </mat-expansion-panel-header>
                    <pre class="code-example">{{errorConfig | json}}</pre>
                    <p>Usage: <code>[errorHandling]="errorConfig"</code></p>
                  </mat-expansion-panel>

                  <mat-expansion-panel>
                    <mat-expansion-panel-header>
                      <mat-panel-title>themeConfig</mat-panel-title>
                    </mat-expansion-panel-header>
                    <pre class="code-example">{{themeConfig | json}}</pre>
                    <p>Usage: <code>[themeConfig]="themeConfig"</code></p>
                  </mat-expansion-panel>
              </div>
            </div>
          </mat-tab>

            <!-- Two-Way Binding Demo -->
          <mat-tab label="Two-Way Binding">
            <div class="tab-content">
                <h3>Live Two-Way Property Binding</h3>
                <div class="binding-grid">
                  <mat-form-field>
                    <mat-label>Zoom</mat-label>
                  <mat-select [(ngModel)]="zoom">
                    <mat-option value="auto">Auto</mat-option>
                    <mat-option value="page-fit">Page Fit</mat-option>
                    <mat-option value="page-width">Page Width</mat-option>
                      <mat-option value="page-actual">Actual Size</mat-option>
                    <mat-option value="50%">50%</mat-option>
                    <mat-option value="125%">125%</mat-option>
                    <mat-option value="200%">200%</mat-option>
                  </mat-select>
                </mat-form-field>

                  <mat-form-field>
                    <mat-label>Cursor</mat-label>
                <mat-select [(ngModel)]="cursor">
                    <mat-option value="select">Text Selection</mat-option>
                  <mat-option value="hand">Hand</mat-option>
                  <mat-option value="zoom">Zoom</mat-option>
                </mat-select>
              </mat-form-field>

                  <mat-form-field>
                    <mat-label>Scroll</mat-label>
                <mat-select [(ngModel)]="scroll">
                  <mat-option value="vertical">Vertical</mat-option>
                  <mat-option value="horizontal">Horizontal</mat-option>
                  <mat-option value="wrapped">Wrapped</mat-option>
                    <mat-option value="page">Page</mat-option>
                </mat-select>
              </mat-form-field>

                  <mat-form-field>
                    <mat-label>Spread</mat-label>
                <mat-select [(ngModel)]="spread">
                  <mat-option value="none">None</mat-option>
                  <mat-option value="odd">Odd</mat-option>
                  <mat-option value="even">Even</mat-option>
                </mat-select>
              </mat-form-field>

                  <mat-form-field>
                    <mat-label>Page Mode</mat-label>
                  <mat-select [(ngModel)]="pageMode">
                  <mat-option value="none">None</mat-option>
                  <mat-option value="thumbs">Thumbnails</mat-option>
                  <mat-option value="bookmarks">Bookmarks</mat-option>
                  <mat-option value="attachments">Attachments</mat-option>
                </mat-select>
              </mat-form-field>

                  <mat-form-field>
                    <mat-label>Rotation</mat-label>
                  <mat-select [(ngModel)]="rotation">
                    <mat-option [value]="0">0¬∞</mat-option>
                    <mat-option [value]="90">90¬∞</mat-option>
                    <mat-option [value]="180">180¬∞</mat-option>
                    <mat-option [value]="270">270¬∞</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

                <div class="current-values">
                  <h4>Current Values (Live Updates)</h4>
                  <div class="value-display">
                    <span>Zoom: <strong>{{zoom}}</strong></span>
                    <span>Cursor: <strong>{{cursor}}</strong></span>
                    <span>Scroll: <strong>{{scroll}}</strong></span>
                    <span>Spread: <strong>{{spread}}</strong></span>
                    <span>Page Mode: <strong>{{pageMode}}</strong></span>
                    <span>Rotation: <strong>{{rotation}}¬∞</strong></span>
                </div>
              </div>
            </div>
          </mat-tab>

            <!-- Actions Demo -->
            <mat-tab label="Actions">
            <div class="tab-content">
                <h3>On-Demand Actions</h3>
                <div class="action-buttons">
                  <button mat-raised-button color="primary" (click)="triggerDownload()">
                    <mat-icon>download</mat-icon> Download
                </button>
                  <button mat-raised-button color="primary" (click)="triggerPrint()">
                    <mat-icon>print</mat-icon> Print
                </button>
                  <button mat-raised-button color="primary" (click)="goToPage(1)">
                    <mat-icon>first_page</mat-icon> Page 1
                </button>
                  <button mat-raised-button color="primary" (click)="goToPage(5)">
                    <mat-icon>last_page</mat-icon> Page 5
                </button>
                  <button mat-raised-button color="primary" (click)="rotateClockwise()">
                    <mat-icon>rotate_right</mat-icon> Rotate CW
                </button>
                  <button mat-raised-button color="primary" (click)="rotateCounterClockwise()">
                    <mat-icon>rotate_left</mat-icon> Rotate CCW
                </button>
              </div>

                <mat-divider></mat-divider>

                <h3>Viewer Management</h3>
                <div class="management-buttons">
                  <button mat-raised-button color="accent" (click)="reloadViewer()">
                    <mat-icon>refresh</mat-icon> Reload Viewer
                </button>
                  <button mat-raised-button color="warn" (click)="testError()">
                    <mat-icon>error</mat-icon> Test Error
                </button>
                  <button mat-raised-button color="primary" (click)="restoreValidPdf()">
                    <mat-icon>restore</mat-icon> Restore Valid PDF
                </button>
              </div>

                <mat-divider></mat-divider>

                <h3>Error Handling Demo</h3>
                <div class="error-config">
                  <mat-form-field class="full-width">
                  <mat-label>Custom Error Message</mat-label>
                    <input matInput [(ngModel)]="errorMessage">
                </mat-form-field>
                  <mat-slide-toggle [(ngModel)]="errorOverride">Override Default Error</mat-slide-toggle>
                  <mat-slide-toggle [(ngModel)]="errorAppend">Append to Default Error</mat-slide-toggle>
              </div>
            </div>
          </mat-tab>
        </mat-tab-group>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- PDF Viewer -->
    <div class="viewer-panel">
      <mat-card>
      <mat-card-header>
          <mat-card-title>ng2-pdfjs-viewer</mat-card-title>
          <mat-card-subtitle>Live Demo with Current Configuration</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
          <!-- trackBy forces component recreation when key changes -->
          <ng2-pdfjs-viewer 
            #pdfViewer
            *ngFor="let _ of [viewerTrackingKey]; trackBy: trackByKey"
            [pdfSrc]="pdfSrc"
            [downloadFileName]="downloadFileName"
            [showSpinner]="showSpinner"
            [spinnerClass]="spinnerCssClass"
            [spinnerHtml]="useCustomSpinnerHtml ? customSpinnerHtml : ''"
            [customSpinnerTpl]="useCustomSpinnerTpl ? spinnerTemplate : null"
            [showOpenFile]="showOpenFile"
            [showDownload]="showDownload"
            [showPrint]="showPrint"
            [showFullScreen]="showFullScreen"
            [showFind]="showFind"
            [showViewBookmark]="showViewBookmark"
            [showAnnotations]="showAnnotations"
              [showToolbarLeft]="showToolbarLeft"
              [showToolbarMiddle]="showToolbarMiddle"
              [showToolbarRight]="showToolbarRight"
              [showSecondaryToolbarToggle]="showSecondaryToolbarToggle"
              [showSidebar]="showSidebar"
              [showSidebarLeft]="showSidebarLeft"
              [showSidebarRight]="showSidebarRight"
            [downloadOnLoad]="downloadOnLoad"
            [printOnLoad]="printOnLoad"
            [showLastPageOnLoad]="showLastPageOnLoad"
            [rotateCW]="rotateCW"
            [rotateCCW]="rotateCCW"
            [namedDest]="namedDest"
            [locale]="locale"
            [useOnlyCssZoom]="useOnlyCssZoom"
            [errorOverride]="errorOverride"
            [errorAppend]="errorAppend"
            [errorMessage]="errorMessage"
            [diagnosticLogs]="diagnosticLogs"
            [theme]="theme"
            [primaryColor]="primaryColor"
            [backgroundColor]="backgroundColor"
            [pageBackgroundColor]="pageBackgroundColor"
            [toolbarColor]="toolbarColor"
            [textColor]="textColor"
            [borderRadius]="borderRadius"
            [customCSS]="customCSS"
            [toolbarDensity]="toolbarDensity"
            [sidebarWidth]="sidebarWidth"
            [toolbarPosition]="toolbarPosition"
            [sidebarPosition]="sidebarPosition"
            [responsiveBreakpoint]="responsiveBreakpoint"
            [(zoom)]="zoom"
            [(cursor)]="cursor"
            [(scroll)]="scroll"
            [(spread)]="spread"
            [(pageMode)]="pageMode"
            [(rotation)]="rotation"
            [(page)]="page"
            (onDocumentLoad)="onDocumentLoad()"
            (onPageChange)="onPageChange($event)"
            (onScaleChange)="onScaleChange($event)"
            (onRotationChange)="onRotationChange($event)"
            (onBeforePrint)="onBeforePrint()"
            (onAfterPrint)="onAfterPrint()"
            (onDocumentError)="onDocumentError($event)"
            (onDocumentInit)="onDocumentInit()"
            (onPagesInit)="onPagesInit($event)"
            (onPresentationModeChanged)="onPresentationModeChanged($event)"
            (onOpenFile)="onOpenFile()"
            (onFind)="onFind($event)"
            (onUpdateFindMatchesCount)="onUpdateFindMatchesCount($event)"
            (onMetadataLoaded)="onMetadataLoaded($event)"
            (onOutlineLoaded)="onOutlineLoaded($event)"
            (onPageRendered)="onPageRendered($event)"
            (onAnnotationLayerRendered)="onAnnotationLayerRendered($event)"
            (onBookmarkClick)="onBookmarkClick($event)"
            (onIdle)="onIdle()">
          </ng2-pdfjs-viewer>

          <!-- Custom spinner template for Phase 2 demo -->
          <ng-template #spinnerTemplate>
            <div style="display:flex;flex-direction:column;align-items:center;gap:10px;color:#444">
              <svg width="40" height="40" viewBox="0 0 50 50" style="animation:ng2-spin 1s linear infinite">
                <circle cx="25" cy="25" r="20" fill="none" stroke="#3f51b5" stroke-width="4" stroke-linecap="round" stroke-dasharray="100" stroke-dashoffset="60"></circle>
              </svg>
              <div>Loading‚Ä¶</div>
        </div>
          </ng-template>
      </mat-card-content>
    </mat-card>
    </div>
    
    <!-- Event Feed Panel (Collapsible) -->
    <mat-card class="feed-panel">
      <mat-card-header>
        <mat-card-title>Event Feed</mat-card-title>
        <span class="spacer"></span>
        <button mat-stroked-button color="primary" (click)="feedPaused = !feedPaused">{{feedPaused ? 'Resume' : 'Pause'}}</button>
        <button mat-stroked-button (click)="eventFeed=[]" style="margin-left:.5rem">Clear</button>
      </mat-card-header>
      <mat-card-content>
        <div class="feed-controls">
          <mat-chip-listbox aria-label="Feed Filters">
            <mat-chip-option (click)="feedFilter.clear()">All</mat-chip-option>
            <mat-chip-option (click)="feedFilter.has('documentLoad') ? feedFilter.delete('documentLoad') : feedFilter.add('documentLoad')">Document</mat-chip-option>
            <mat-chip-option (click)="feedFilter.has('pageRendered') ? feedFilter.delete('pageRendered') : feedFilter.add('pageRendered')">Render</mat-chip-option>
            <mat-chip-option (click)="feedFilter.has('find') ? feedFilter.delete('find') : feedFilter.add('find')">Find</mat-chip-option>
            <mat-chip-option (click)="feedFilter.has('outlineLoaded') ? feedFilter.delete('outlineLoaded') : feedFilter.add('outlineLoaded')">Outline</mat-chip-option>
            <mat-chip-option (click)="feedFilter.has('documentError') ? feedFilter.delete('documentError') : feedFilter.add('documentError')">Errors</mat-chip-option>
          </mat-chip-listbox>
        </div>
        <div class="feed-list">
          <div class="feed-item" *ngFor="let e of eventFeed">
            <span class="feed-time">{{e.time}}</span>
            <span class="feed-type">{{e.type}}</span>
            <span class="feed-data" *ngIf="e.data as d">{{ d | json }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div> 